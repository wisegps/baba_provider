<!--
	作者：小吴
	时间：2015-11-10
	描述：车辆管理页面,目前用于展示框架的使用，会尽量详细的写各种注释
-->
<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
			
		<title>车辆管理</title>
		<!--必须最先引入WiStorm.js文件-->
		<script src="../wslib/WiStorm.js"></script>
		
		<!--使用link()引入css文件，无需写路径，直接写文件名即可,尽量少引入css，样式如果少（小于10k为少），
		可以直接写在style元素里，放到body元素后面-->
		<script>link("W.css")</script>
		<script>link("ui.css")</script>
		
		<!--其他js文件需在css文件后面引入，如果是在加载完页面之后才会用到的，使用defer属性异步加载;或者直接放到body后面；
			同样尽量少引入js文件；
			现在接口可能需要你们自己封装，参考wslib/api/WUserApi.js里的封装方式
			-->
		<script src="../wslib/api/WUserApi.js" defer="defer"></script>
		<script src="ui/ui.js"></script>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-icon mui-icon-left-nav mui-pull-left W_back"></a>
			<h1 class="mui-title">车辆管理</h1>
		</header>
		<div class="mui-content">
			<div class="mui-input-row mui-search">
				<input type="search" class="mui-input-clear" id="search_input" placeholder="输入车牌号查询车辆">
			</div>
			<div id="car_list"></div>
		</div>
	</body>
	<style>
		body{background-color: #EFEFF4;}
	</style>
	<script>
		function cv(data){
			var obj=new WiStormUI("div");//创建一个div组件
			
			obj.merge(this);//将原型cv.prototype中的方法赋予当前obj
			
			obj.className="ui_car_d";//设置div的class属性
			
			obj.setData(data);//设置obj的内容,setData()在下面cv.prototype中定义
			
			return obj;//最后记得要返回组件
		}
		//给组件添加对象方法
		cv.prototype.getData=function(){
			return this.data;
		}
		
		cv.prototype.setData=function(data){
			this.innerHTML='<table><tr><th><img src="http://img.wisegps.cn/logo/m_8_100.png"><span name="value">'+data.obj_name+'</span></th><th name="tip">已安装设备</th></tr><tr><td><span class="name">客户名称:</span><span class="value">'+data.nick_name+'</span></td><td><span class="name">车型:</span><span class="value">'+data.car_type+'</span></td></tr><tr><td><span class="name">行驶里程:</span><span class="value">56000公里</span></td><td><span class="name">维修类型:</span><span class="value">保养</span></td></tr></table><footer><button type="button" class="mui-btn mui-btn-warning edit">完善资料</button></footer>';
			
			var a=this.querySelector(".edit");
			a.addEvent("click",cv.editData);//给其中的按钮添加点击事件监听，使用cv.editData来处理点击事件
			
			this.querySelector("footer").appendChild(new ui_checkInBtn(data.obj_id));
			
			this.data=data;//直接把数据缓存进入组件（按需求，如果数据是需要重复用的就这样缓存）
		}
		
		/**
		 * 这种定义方式与上面的cv.prototype不一样，只是单纯的定义一个方法而已，不会被对象使用；
		 * 使用时直接   cv.editData();   这样使用，好处是节省命名空间，同时表示了方法与组件之间有联系；
		 * 阅读起来更方便;
		 * 如这个方法是被组件内 “完善资料”按钮所调用的，使用在setData时会添加为该按钮的事件处理器
		 */
		cv.editData=function(){
			alert("跳转到完善资料页面");
			window.plus.webview.open("msg");
		}
		
		//监听 html加载完成事件
		window.addEventListener("DOMContentLoaded",function(){
			W("#search_input")
			
			
			//调用接口，获取用户车辆,并绘制到页面上
			W.userApi.getCarList(function(res){
				if(res&&res.status_code){
					alert(res.msg+";"+res.err_msg);
				}
				if(!W.dom.carList)
					W.dom.carList=W("#car_list");//缓存经常使用的元素;W()为元素选择器，使用css选择规则，有两个参数，具体查看WiStorm.js
												 //W.dom是一个json，专门用于缓存元素
												 								 
				/*创建DocumentFragment碎片；
				构造列表时不要每创建一个元素就添加到页面里，这样会造成性能低下，把元素添加到DocumentFragment，
				最后再把DocumentFragment添加到页面*/
				var list=document.createDocumentFragment();
				
				
				for(var i=res.length-1;i>=0;i--){
					list.appendChild(new cv(res[i]));//创建一个cv组件，并添加到DocumentFragment里
				}
				W.dom.carList.appendChild(list);//把整个列表添加到页面
			});
		});
		
		//至此，一个页面就基本完成了
	</script>
</html>